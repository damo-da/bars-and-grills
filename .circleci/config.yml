version: 2.1

orbs:
  node: circleci/node@4.0.0

jobs:
  django-test:
    working_directory: ~/barsandgrills
    docker:
      - image: circleci/python3.8.4
    steps:
        - checkout
        - run: "cd backend"
        - run: |
            python3 -m venv venv
            . venv/bin/activate
            pip install -r requirements.txt
        - save_cache:
            key: deps1-{{ .Branch }}-{{ checksum "requirements.txt" }}
            paths:
              - "venv"
        - run: |
            . venv/bin/activate
            python3 manage.py test --settings=api.tests.settings
workflows:
  tests:
    jobs:
      - django-test
      - node/test:
            app-dir: ./app

